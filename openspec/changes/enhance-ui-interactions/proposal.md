# 变更：增强 UI 交互和面板组件

## 为什么

当前的面板标题栏和文件列表组件存在以下用户体验问题：

1. **路径展示不直观**：当前仅显示完整路径字符串（如 `/Users/ggymm/Documents`），用户难以快速识别目录层级和当前位置
2. **缺少面板关闭功能**：用户无法关闭不需要的面板，导致拆分后的面板只能累积，无法清理
3. **组件命名不清晰**：`panel_title_bar` 组件名称与其单一职责（路径展示）不匹配
4. **文件选择交互缺失**：文件列表不支持选中状态，用户无法进行批量操作，且悬停和选中状态未区分

这些问题严重影响多面板文件管理的效率和体验，需要优先解决。

## 变更内容

### 1. 路径层级展示组件

- **重命名组件**：将 `PanelTitleBar` 重命名为 `PathBreadcrumb`，专注于路径层级展示
- **实现面包屑导航**：将路径拆分为多个层级，使用 Windows 风格的展示
  - 每个文件夹名称作为一个可点击的面包屑项
  - 文件夹之间使用 `>` 图标（ChevronRight）分隔
  - 点击任意层级可快速跳转到该目录
- **文件夹名称长度限制**：
  - 每个文件夹名称组件设置最大显示宽度
  - 超出宽度后使用省略号（...）截断
  - 悬停时显示完整名称的 tooltip
- **长路径优化**：
  - 当面包屑链的总宽度超过容器可用宽度时，采用首尾显示策略
  - 动态计算每个段的实际渲染宽度
  - 显示：根目录 + 第一级 + 省略号图标（Ellipsis）+ 倒数第二级 + 当前目录
  - 示例：`/ > Users > ... > Documents > current`（当完整路径显示不下时）
- **省略号菜单**：
  - 省略号使用专用图标（ellipsis.svg）
  - 点击省略号图标弹出下拉菜单
  - 菜单显示被省略的所有中间层级
  - 点击菜单项可跳转到对应目录
- **添加关闭按钮**：在面包屑右侧添加关闭按钮
  - 使用 Close 图标
  - 点击后触发面板关闭回调
- **图标支持**：在 `IconName` 枚举中添加 `ChevronRight`、`Close` 和 `Ellipsis` 图标
- **设计参考**：整体交互和视觉设计参考 Windows 资源管理器的地址栏

### 2. 文件列表选中状态

- **添加选中状态管理**：
  - 在 Explorer 应用中维护选中文件/文件夹列表
  - 支持单选和多选（使用 Ctrl/Cmd 键）
  - 支持范围选择（使用 Shift 键）
- **视觉状态区分**：
  - 选中项：显示明显的边框（使用主题 accent 颜色）
  - 悬停项：显示背景高亮（使用主题 muted 颜色）
  - 确保选中和悬停状态可同时存在且视觉上可区分
- **选中事件处理**：
  - 扩展 `ListItem` 组件支持 `selected` 状态
  - 添加 `on_select` 回调，传递选中状态变化
  - 支持键盘导航（方向键、Enter、空格键）

### 3. 面板关闭逻辑

- **实现面板移除**：在面板树中支持移除指定 Panel ID 的节点
- **处理边界情况**：
  - 关闭叶子节点：移除该节点，其父 Split 节点替换为兄弟节点
  - 关闭 Split 节点：递归移除整个子树
  - 最后一个面板不可关闭
- **状态更新**：关闭激活面板时，自动激活相邻面板

## 影响

### 受影响的规范
- **ui-components**：PathBreadcrumb 组件、图标系统扩展
- **file-list**：选中状态管理、多选支持

### 受影响的代码
- `crates/explorer-component/src/panel_title_bar.rs` → `path_breadcrumb.rs`：重命名并重写为面包屑组件
- `crates/explorer-component/src/icon.rs`：添加 ChevronRight 和 Close 图标
- `crates/explorer-component/src/list/mod.rs`：扩展 ListItem 支持选中状态和边框
- `crates/explorer-app/src/main.rs`：
  - 添加选中文件状态管理
  - 实现面板关闭逻辑
  - 处理文件选中事件

### 架构影响
- 路径展示从简单字符串转变为可交互的层级结构
- 文件列表从只读视图扩展为支持选择的交互组件
- 面板树支持动态移除节点
