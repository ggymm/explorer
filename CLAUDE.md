<!-- OPENSPEC:START -->
# OpenSpec 指令

这些指令适用于在本项目中工作的 AI 助手。

**全局强制性规则：本项目中所有新建或修改的文档必须使用中文编写。**

当请求满足以下条件时，始终打开 `@/openspec/AGENTS.md`：
- 提及规划或提案（如 proposal、spec、change、plan 等词）
- 引入新功能、破坏性更改、架构调整或重大性能/安全工作
- 听起来模糊，在编码前需要权威规范

使用 `@/openspec/AGENTS.md` 来学习：
- 如何创建和应用变更提案
- 规范格式和约定
- 项目结构和指南

保留此托管块，以便 'openspec update' 可以刷新指令。

<!-- OPENSPEC:END -->

---

## 项目开发约束规则

以下是在本项目开发过程中必须严格遵守的关键约束规则。这些规则基于实际开发经验总结，违反这些规则将导致重大失误和时间浪费。

### 1. GPUI 框架限制（重大失误警告）

**严格禁止使用以下不存在的方法：**
- ❌ `z_index()` - GPUI 中不存在此方法
- ❌ `pointer_events_none()` - GPUI 中不存在此方法
- ❌ 任何其他未在 GPUI 文档中明确说明的方法

**正确的实现方式：**
- ✅ 使用 `absolute()`、`relative()` 进行定位
- ✅ 使用 `inset_0()`、`top()`、`left()` 等设置位置
- ✅ 使用渲染顺序控制层级（后渲染的元素在上层）
- ✅ 查阅实际代码示例和 GPUI 文档确认方法存在性

**警告**：反复添加又删除不存在的方法属于重大失误，必须在编码前确认 API 可用性。

### 2. 需求理解与确认（严重失误警告）

**问题**：对用户提出的问题理解错误，导致反复重复错误操作，浪费大量时间。

**必须遵循的流程：**
1. ✅ **先理解，后执行**：收到任务后，用自己的话复述理解
2. ✅ **主动确认**：如有任何不确定的地方，立即询问澄清
3. ✅ **分步说明**：说明将要执行的步骤，等待确认
4. ✅ **验证理解**：对于复杂需求，先描述实现思路再开始编码
5. ✅ **尊重已确认的设计**：已经确认可行的设计方案，绝不擅自修改

**禁止行为：**
- ❌ 在理解不清的情况下直接开始编码
- ❌ 发现问题后重复相同的错误尝试
- ❌ 假设用户的意图而不是询问确认
- ❌ **擅自改变已确认的设计方案**（即使认为有"更好"的方式）

**重要原则**：当用户说"改回去，这个设计没问题"时，说明我擅自修改了已验证可行的方案。必须严格遵守已确认的设计决策。

### 3. 复杂任务处理（完全错误警告）

**严格禁止的行为：**
- ❌ 因为任务复杂而拒绝执行
- ❌ 在代码中添加 `TODO` 注释留待以后实现
- ❌ 实现部分功能后声称"其余部分过于复杂"
- ❌ 使用"这需要更多时间"作为不完成任务的理由

**正确的处理方式：**
1. ✅ **任务分解**：将复杂任务分解为多个小步骤
2. ✅ **实施计划**：向用户说明详细的实施计划
3. ✅ **逐步实现**：按计划逐步完整实现每个部分
4. ✅ **完整交付**：确保所有功能完全实现，无遗留 TODO

**原则**：无论任务多复杂，都必须通过合理分解来完整实现，而不是回避。

### 4. 禁止的实现方式（永久记忆）

以下实现方式已被明确禁止，除非用户明确允许，否则**永远不要以任何理由再次使用**：

#### 4.1 已禁止的技术方案
- ❌ 使用 `z_index()` 控制层级（GPUI 不支持）
- ❌ 使用 `pointer_events_none()`（GPUI 不支持）

#### 4.2 已禁止的开发模式
- ❌ 添加 TODO 注释而不实现功能
- ❌ 因复杂度而简化需求（除非用户同意）
- ❌ 反复尝试已被证明不工作的方案

**更新机制**：当用户明确禁止某个实现方式时，必须立即添加到此列表中。

### 5. 提交前强制验证（关键工作流程）

**铁律：没验证之前不能提交**

**强制执行的验证流程：**
1. ✅ **编译验证**：确保代码编译通过，无错误无警告
2. ✅ **功能测试**：实际运行并测试所有新增/修改的功能
3. ✅ **回归测试**：确保现有功能未被破坏
4. ✅ **用户确认**：向用户报告测试结果，等待确认
5. ✅ **验证通过后才能提交**

**提交检查清单：**
- [ ] 代码编译无错误无警告
- [ ] 所有功能实际测试通过
- [ ] 无遗留 TODO
- [ ] 用户已确认功能正常
- [ ] 提交信息清晰描述变更

**严格禁止：**
- ❌ 未经测试就提交代码
- ❌ 编译有警告就提交
- ❌ 功能未完全实现就提交
- ❌ 未得到用户确认就提交

### 6. 代码质量要求

**必须遵循：**
- ✅ 所有代码必须完整实现，无 TODO
- ✅ 所有功能必须经过测试验证
- ✅ 使用框架实际支持的 API
- ✅ 遵循项目现有的代码风格和架构模式

**禁止：**
- ❌ 提交包含 TODO 的代码
- ❌ 使用不确定是否存在的 API
- ❌ 跳过测试验证步骤

---

**重要提示**：违反以上任何规则都会导致显著的时间浪费和开发效率下降。请在每次开始工作前重新审视这些约束。